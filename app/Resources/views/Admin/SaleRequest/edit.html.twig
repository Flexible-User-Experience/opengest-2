{% extends "::Admin/edit.html.twig" %}

{# override javascript includes #}
{% block javascripts %}
    {{ parent() }}
    <script src="{{ asset('bundles/fosjsrouting/js/router.min.js') }}"></script>
    <script src="{{ path('fos_js_routing_js', { callback: 'fos.Router.setData' }) }}"></script>

    <script type="text/javascript">
        jQuery(document).ready(function() {
             // Handler for .ready() called.
            var partnerNode = jQuery('#sonata-ba-field-container-{{ form.partner.vars.id }}');
            var cifNif = jQuery('#{{ form.cifNif.vars.id }}');
            var mainAddress = jQuery('#{{ form.mainAddress.vars.id }}');
            var mainCity = jQuery('#{{ form.mainCity.vars.id }}');
            var province = jQuery('#{{ form.province.vars.id }}');
            {#var paymentType = jQuery('#{{ form.paymentType.vars.id }}');#}

             //on change
            partnerNode.change(function(event) {
                console.log(event);
                var partnerId = event.val;
                jQuery.get( Routing.generate('admin_app_partner_getJsonPartnerById', { id: partnerId }), function() {
                }).done(function(response) {
                    updateNodesInfo(response);
                });
            });

            //on load
            {% if form.partner.vars.data is not null %}
                jQuery.get( Routing.generate('admin_app_partner_getJsonPartnerById', { id: {{ form.partner.vars.data.id }} }), function() {
                }).done(function(response) {
                     updateNodesInfo(response);
                });
            {% endif %}

            function updateNodesInfo(response) {
                var partner = jQuery.parseJSON(response);

                cifNif.val(partner.cifNif);
                mainAddress.val(partner.mainAddress);
                mainCity.val(partner.mainCity.name);
                province.val(partner.mainCity.province.name);
            }

        });
    </script>
{% endblock %}
