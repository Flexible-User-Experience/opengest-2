{% extends "::Admin/edit.html.twig" %}

{# override javascript includes #}
{% block javascripts %}
    {{ parent() }}
    <script type="text/javascript">
        jQuery(document).ready(function() {
             // Handler for .ready() called.
            var partnerNode = jQuery('#sonata-ba-field-container-{{ form.partner.vars.id }}');
            var cifNif = jQuery('#{{ form.cifNif.vars.id }}');
            var mainAddress = jQuery('#{{ form.mainAddress.vars.id }}');
            var mainCity = jQuery('#{{ form.mainCity.vars.id }}');
            var province = jQuery('#{{ form.province.vars.id }}');
            var paymentType = jQuery('#{{ form.paymentType.vars.id }}');

             //on change
            partnerNode.change(function(event) {
                console.log(event);
                var partnerId = event.val;
                // TODO AVOID HARDCORED ROUTES
                jQuery.get( "/admin/tercers/tercer/"+partnerId+"/get-json-partner-by-id", function() {
                    console.log( "success" );
                }).done(function(response) {
                    console.log(response);
                });
            });

            //on load
            jQuery.get( "/admin/tercers/tercer/{{ form.partner.vars.data.id }}/get-json-partner-by-id", function() {
                console.log( "success" );
            }).done(function(response) {
                var partner =jQuery.parseJSON(response);
                console.log(response);
                console.log(partner);

                cifNif.val(partner.cif_nif);
                mainAddress.val(partner.main_address);
                mainCity.val(partner.main_city.name);
                province.val(partner.main_city.province.name);
            });


        });
    </script>
{% endblock %}
